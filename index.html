// Handle prospect form submission - FIXED TO CLOSE IMMEDIATELY
async function handleProspectSubmit(e) {
    e.preventDefault();

    const name = document.getElementById('prospect-name').value;
    if (!name) {
        alert('Please enter a client name');
        return;
    }

    const prospectData = {
        name: name,
        phone: document.getElementById('prospect-phone').value,
        status: document.getElementById('prospect-status').value,
        notes: document.getElementById('prospect-notes').value,
        userId: currentUser.uid,
        createdAt: new Date(),
        lastUpdated: new Date()
    };

    // CLOSE THE MODAL IMMEDIATELY - don't wait for Firebase
    closeProspectModal();

    try {
        const docId = document.getElementById('prospect-doc-id').value;

        if (docId) {
            await setDoc(doc(db, 'prospects', docId), prospectData);
            console.log("Prospect updated");
        } else {
            await addDoc(collection(db, 'prospects'), prospectData);
            console.log("Prospect added");
        }
        
        // The prospect list will automatically update via the real-time listener
        // So the user sees the new/updated prospect immediately on the dashboard
        
    } catch (error) {
        console.error("Error saving prospect:", error);
        alert('Error saving prospect. Please try again.');
    }
}
